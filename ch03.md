## 3장

배포하기
1. Dockerfile 만들기
	- Dockerfile은 밀키트 레시피를 적는 곳 
	- 어떤 **OS**를 설치해야 되는지 
	- 어떤 **프로그램 라이브러리**를 설치해야 하는지 
	- 어떤 **터미널 명령어**를 실행할 건지 적어 놓는 곳
	- 내 컴퓨터에 있던 파일은 **어디 집어넣을** 것인지

#### Dockerfile 예시
```
FROM node:22.13-slim
WORKDIR /app
COPY . .
RUN ["npm", "install"]
EXPOSE 8000
CMD ["node", "server.js"]
```
예시)에 넣는 과정
1. OS하나 설치하고
2. nodejs설치하고
3. npm install express 터미널에 입력하고
4. 서버 코드 작성하고
5. node server.js 터미널에 입력

#### FROM 명령어
어떤 OS환경에서 내 프로그램을 실행할지부터 정해야기 때문에 FROM 부터 시작
- Docker hub에서 찾아오면 됨
	- windows 설치하고 싶을시 windows 검색해서 기재
	- 리눅스 OS 설치하고 싶으면 (ubuntu, devian, rehat, alpine) 검색해서 기재
	- 리눅스 서버비가 덜 들기 때문에 리눅스 씀
	- 리눅스 + Node.js 함께 설치된걸 이미 만들어둔 사람도 있어서 그거 설치하면됨
	- **FROM node:22-alpine** 으로 기재하면 Node.js 22버전과 리눅스 os가 설치된 채로 시작
	- slim은 devian 리눅스에서 필요없는거 지운거 alpine은 용량이 가장 작은 리눅스

```
(Dockerfile)

FROM scratch
```
바이너리로 컴파일한 파일만 돌리면 되는경우 OS설치가 딱히 필요없으므로 빈 도화지에서 시작시키기도 함

#### RUN 명령어
- RUN 뒤에 있는 명령어를 실행해줌
- 설치해야 하는 라이브러리가 많은 경우 package.json를 복사해오고 그 다음에 npm install을 입력하면 package.json에 기록되어 있던 라이브러리를 그대로 설치해주는 기능이 있음
- 대괄호를 사용해서 명령어를 입력하는 방식이 더 안정적임
	- 괄호를 안치면 /bin/sh -c npm install 이라는 명령어가 실행이 되는데 이것은 내 os에 기본적으로 설치된 shell을 이용해서 실행하라는 소리다 때문에 shell이라는 프로그램과 거기서 제공하는 && || 이런 명령어가 필요하면 괄호없이 쓰면되는데 shell 기능이 필요없거나 OS마다 shell이 서로 다를 수 있어서 대괄호를 사용용

#### COPY 명령어
```
COPY 내컴퓨터파일경로 이미지내부파일경로

COPY . .
```
. 은 현재 경로이므로 모든 파일과 폴더들을 가상컴퓨터 현재 경로로 복사한다는 뜻

#### .dockerignore
node_modules같은 라이브러리 소스코드는 궅이 복사할 필요가 없음
- 이런 파일은 .dockerignore 파일을 만들어서 파일이나 폴더 경로를 기재하면 됨


#### WORKDIR 
/app 같은 폴더 하나를 만들어서 이동 시키면 파일이 깔끔함
- 현재 작업 경로를 /app 폴더로 바꿔주고 /app 폴더가 없으면 하나 만들어줌


#### CMD 
마지막 명령어는 RUN 말고 CMD 뒤에 적음


#### EXPOSE
EXPOSE 명령어 뒤에 8080 이런 식으로 포트번호를 기재할 수 있습니다.
포트가 뭐냐면 컴퓨터에 뚫린 구멍입니다. 
이게 뚫려있어야 외부 사람들이 내 컴퓨터로 접속이 가능해서 웹서버 운영하는 컴퓨터도 포트를 하나 뚫어줘야합니다.
그래서 코드짤 때 8080 이런 포트를 뚫으라고 코드짜놨습니다.
그래서 이미지 돌릴 컴퓨터에도 8080 포트를 오픈하라고 해야하는데 그건 이미지 실행할 때 명령줄 수 있습니다.
근데 위처럼 EXPOSE 8080 이런걸 작성해놓으면 나중에 포트 오픈하라고 명령줄 때 약간 편리합니다.
그래서 편의를 위해 쓰는 메모같은 개념입니다. 없어도 상관은 없음


#### docker build
```
docker build -t 이미지이름:태그 .
```
작성한 Dockerfile를 바탕으로 이미지를 하나 만들어서 명령을 내릴 수 있음
- 이미지 이름은 맘대로 작명합시다.
- 태그도 맘대로 작명합시다. 태그는 버전이랑 비슷하게 취급하면 됩니다.
- 마침표자리에는 Dockerfile 경로 입력하면 되는데 마침표는 현재경로라는 뜻입니다.
- 참고로 docker desktop 또는 docker engine이 실행되고 있어야 이거 명령어도 사용가능합니다.

이미지 확인은 docker desktop 들어가보거나 터미널에 docker images 입력해봅시다.