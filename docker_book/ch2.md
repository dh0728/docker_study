# 🐋 2. 도커의 동작 원리

## 💡도커의 동작 원리

### 🐬 도커의 구조
일반적인 서버 -> 운영체제 위에 프로그램이나 데이터가 직접 올라가지만
도커를 사용하는 경우 -> **운영체제 위에 도커 엔진이 동작하고 그 위에 컨테이너가 동작**한다. 프로그램이나 데이터는 컨테이너 안에 위치함


![alt text](image-17.png)

### 🐬 컨테이너 안에는 운영체제 '비스한 것'들이 들어있다.
**모든 컨테이너에는 '리눅스 운영체제 비숫한 무언가'가 들어있다.**

![alt text](image-18.png)

### 🐬 운영체제가 하는 일은 뭘까?
운영체제는 기본적으로 **소프트웨어나 프로그램의 명령을 하드웨어에 전달하는 역할**을 한다.

![alt text](image-19.png)

현재 도커의 구조를 보면 **도커 엔진 아래에도 리눅스 운영체제가 있는데, 컨테이너 속에 또 리눅스 운영체제(비슷한 것)이 있는 구조**이다.<br>
본래 운영체제는 **커널**이라는 부분과 **그 외의 주변 부분**으로 구성된다. <br>
**주변 부분**이 프로그램의 연락 내용을 커널에 전달하고 커널이 하드웨어를 다룬다.

도커에서는 컨테이너가 완전히 분리돼 있어서 밑바탕이 되는 리눅스 운영체제의 주변 부분이 컨테이너 속 프로그램의 명령을 전달받을 수 없음<br>
따라서 컨테이너 속의 운영체제의 주변 부분이 들어 있어 프로그램의 명령을 전달받고 이를 밑바탕이 되는 커널에 전달하는 구조

컨테이너 속의 '리눅스 운영체제 비슷한 것'이 들어 있는 이유!! <br>
주변 부분만 컨테이너에 넣고 커널은 밑바탕에 있는 것을 빌려쓰는 형태 덕분에 **가벼움**을 얻었다 할 수 있음


![alt text](image-20.png)

### 🐬 도커는 기본적으로 리눅스용이다.

도커는 기본적으로 **리눅스 운영체제**에서만 동작(밑바탕에서 리눅스 운영체제가 동작하는 것을 전제로 하는 구조)
- 컨테이너 안에 들어 있는 주변부분, 컨테이너에서 실행할 소프트웨어 모두 리눅스용 맞는 것들이어야함

-> 도커는 리눅스 컴퓨터에 독립된 격리환경을 만드는 것이며, 리눅스에서만 동작하고, 컨테이너에서 동작할 프로그램도 리눅스용 프로그램이다.

도커에 대한 이야기가 대체로 서버 환경의 전제로 한 것이 많은데 이것도 리눅스 운영체제가 서버에서 사용되는 경우가 많고 리눅스용 소프트웨어도 서버용이 많아서이다.

![alt text](image-21.png)

### 🐬 원도우와 macOS에서 도커 구동하기
도커를 윈도우나 macOS에서 사용하기 위해서는

1. VirtualBox, VMware 같은 가상 환경 위에 리눅스 운영체제를 설치하고 그위에서 도커를 실행
2. '원도우용 또는 macOS용 도커 데스크톱'처럼 도커를 실행하는데 필요한 리눅스 운영체제가 포함되는 패키지를 설치해 사용하는 두가지 경우로 나뉨

하는 방법이 있다. 간단히 말해 윈도우나 macOS 위에 리눅스 운영체제를 끌어들여 도커를 실행하는 것이다
-> **어떤 형태는 리눅스 운영체제가 반드시 필요함!!**

![alt text](image-22.png)

## 💡도커 허브와 이미지, 그리고 컨테이너

### 🐬 이미지와 컨테이너
컨테이너를 생성하기 위해서는 먼저 이미지를 만들어야 함
- 이미지 : 빵틀, 컨테이너의 설계도

![alt text](image-23.png)

![alt text](image-24.png)

### 🐬 컨테이너로도 이미지를 만들 수 있다.

컨테이너로 이미지를 만드는 것은 이미 만든 컨테이너에 손을 대서 컨테이너의 금형을 새로이 만드는 과정

![alt text](image-25.png)

컨테이너로 이미지를 만들 수 없었다면 여러 개의 컨테이너를 일일이 수정할 수밖에 없음
개조된 컨테이너로 이미지를 만들면 새로 만든 이미지를 사용해 개조된 컨테이너를 여러 개 만들 수 있다.

![alt text](image-26.png)

### 🐬 도커 엔진 간에 이동이 가능하다.

동일한 컨테이너를 여러 개 만들지 않더라도 이러한 특성을 이용해 다른 물리 서버에 설치된 도커 엔진으로 이동시킬 수 있음<br>
컨테이너는 도커 엔진만 설채돼 있으면 구동이 가능하기 때문<br>

![alt text](image-27.png)

### 🐬 도커 허브와 도커 이미지
초보자가 컨테이너 이미지를 밑바닥부터 만들어 낼 일은 거의 없다. 
굳이 만든다면 빈 컨테이너에 운영체제(비슷한 것)을 포함시켜 만드는 경우가 있겠지만 이런 경우에도 주로 사용할 이미지가 이미 준비돼 있다.

이미지는 **도커 허브**에서 주로 구한다.
도커허브 : 공식적으로 운영되는 도커 레지스트리(도커 이미지를 배포하는 서비스)의 이름

![alt text](image-28.png)

![alt text](image-29.png)


### 🐬 도커 허브에는 어떤 이미지가 공개돼 있을까?

도커 허브에는 운영체제 비슷한 것만 있는 이미지부터, 여러가지 소프트웨어가 함께 포함된 것까지 다양한 이미지가 제공된다.

![alt text](image-30.png)

![alt text](image-31.png)

![alt text](image-32.png)

### 🐬 안전한 컨테이너 이미지를 고르는 법
도커 허브는 누구나 자유롭게 이미지를 등록할 수 있기 때문에 안전하지 않은 이미지가 있을 수 있다. 따라 안전한 이미지를 선택하는 방법을 알아보자

1. 공식 이미지를 사용한다.
    - 컨테이너에 포함된 운영체제(비슷한 것)의 특정 운영체제 및 버전으로 한정된 경우가 있어서 원하는 것을 선택하지 못할 수도 있음
2. 커스텀 이미지를 직접 만들어 사용하자
3. 다양한 형태로 조합이 가능한 컨테이너
    - '한 컨테이너 한 프로그램'이라는 것이 있다. 하나의 프로그램만 담기 컨테이너를 사용하는 거이 보안 및 관리 측면에서 유리하기 때문에 많이 쓰이는 정책

![alt text](image-33.png)

![alt text](image-34.png)

## 💡도커 컨테이너의 생애주기와 데이터 저장

### 🐬 도커 컨테이너는 '쓰고 버리는' 일회용품

**컨테이너는 '쓰고 버리는' 일회 용품 같은 것이다.**
컨테이너는 하나를 업데이트하면서 계속 사용하기보다는 업데이트된 소프트웨어가 들어있는 새로운 컨테이너를 사용하는 것이 좋다. <br>
즉, 새로운 버전이 나오면 새로운 컨테이너로 갈아타는 것이다.

이것이 가능한 이유는 컨테이너는 일반적으로 여러 개를 동시 가동하는 상황을 전제로 하기 때문이다. 
여러 개의 컨테이너를 하나하나 업데이트하는 것은 많은 수고가 든다. 초기 구축은 간단히 
마쳤는데 유지보수 할 때마다 컨테이너를 일일일 업데이트하려니 컨테이너의 장점이 반감된다. 유지보수 횟수가 많은 것도 그렇다.

이러한 이유로 오래된 컨테이너를 버리고 새로운 이미지로부터 새로운 컨테이너를 만들어 갈아타는 방식을 사용한다.

![alt text](image-35.png)

🚨 **컨테이너를 '만들고', '실행하고', '종료하고', '페기한' 다음, 다시 컨테이너를 '만드는' 일련의 과정을 '컨테이너 생애주기'라고 부른다.**

![alt text](image-36.png)

### 🐬 데이터 저장

만약 컨테이너를 폐기하면 안에 들어있는 데이터는?

컨테이너를 폐기하면 안에 있는 파일은 당연히 사라진다. 이런 일을 방지하기 위해 보통 **도커가 설치된 물리적 서버(호스트)의 디스크를 마운트해** 이 디스크에 데이터를 저장한다. <br>
마운트는 '디스크를 연결해 데이터를 기록할 수 있도록 한 상태'를 의미하는데 도커 컨테이너를 물리적 컴퓨터의 디스크(HDD 또는 SSD)를 연결해 데이터를 기록할 수 있다.<br>

![alt text](image-37.png)

![alt text](image-38.png)


## 💡도커의 장점과 단점

### 🐬 도커의 구조와 성질 및 그 장단점

![alt text](image-39.png)

핵심이 되는 성질은 **환경을 격리할 수 있다**는 점이다. <br>
이러한 성질 덕분에 하래의 구조가 가능했다.

#### 독립된 환경
    독립된 환경 덕분에 '여러 개의 컨테이너를 띄울 수' 있으며 '똑같은 애플리케이션도 여러 개 띄울 수' 있다.

#### 이미지를 만들 수 있다.
1. 스스로 만들지 않아도 이미지를 내려받기만 하면 컨테이너를 사용할 수 있다.
2. 구축 작업이 간단해 지므로 **교체가 쉽고 업데이트가 쉽다.**
3. 이동성이 좋다. 똑같은 컨테이널르 계속 만들수 있으므로 **'환경 이동'이나 '개발환경 구축'**이 쉽다.

#### 컨테이너에 '커널'을 포함 시킬 필요가 없다.
컨테이너에는 커널(운영체제의 핵심이 되는 부분)을 포함시킬 필요가 없으므로 가법다. 또 배포판도 원하는 것을 사용할 수 있다.

### 🐬 도커의 장점과 단점

### 🐬 장점  

#### 한 대의 물리 서버에 여래 대의 서버를 띄울 수 있다.
한 대의 물리 서버에 여러 가지 기능을 안전한 상태로 띄울 수 있다. (격리된 환경을 제공하기 때문에)
또한 일반적인 서버에서는 함께 실행할 수 없는 조합(같은 소프트웨어를 여러 벌 실행하는)도 가능 <br>

또 컨테이너는 커널이 포함 X -> 물리 서버의 운영체제에 의존한다. <br>
이러한 이유로 소프트웨어적으로 하드웨어를 재현하는 가상화 기술에 비하면 압도적으로 가볍다.


#### 서버 관리가 용이하다.
각각 독립된 한경에 격리하므로 다른 소프트웨어에 영향을 끼치지 않아 업에이트가 간단하고, 항상 최신 상태롤 소프트웨어를 유지하기 쉬운 구조가 된다. <br>
컨테이너의 교체나 수정이 쉬워 환경이전이 간단하고 생성 및 폐기도 간단하므로 초기 설정에 따르는 시간과 수고를 들일 필요가 없다.

#### 서버 고수가 아니어도 다루기 쉽다.

명령 한 줄로 서버 구축이 끝나므로 '터미널에 명령을 직접 입력해야 한다는' 것 외에는 장애물이 없다.


### 🐬 단점

1. 리눅스용 소프트웨어 밖에 지원하지 않다
    - 서버에서는 리눅스 운영체제를 많이 사용하긴 해도 유닉스도 사용할 수 없고 윈도우 서버는 아예 지원하지 않는다. 

2. 물리 서버 한 대에 여러 대의 서버를 띄우는 형태이므로 호스트 서버에 문제가 생기면 모든 컨테이너에 영향을 미친다.
- 물리 서버의 이상에 대해 확실히 대책을 세워야 한다.

3. 컨테이너를 여래 개를 사용하는 형태를 가정하므로 컨테이너 하나를 장기간에 결쳐 사용할 때는 그리큰 장점을 느끼기 어렵다.
    - 도커를 사용하려면 반드시 도커 엔진을 구동해야 하는데, 컨테이너를 하나밖에 사용하지 않는다면 도커 엔진이 단순한 오버헤드에 지나지 않기 떄문

### 🐬 도커의 주 용도

1. 팀원 모두에게 동일한 개발환경 제공(=동일한 환경을 여러 개 만들기)
2. 새로운 버전의 테스트(= 격리된 환경을 이용)
    - 운영체제나 라이브러리 등의 새로운 버전을 먼저 개발환경에서 테스트한 후 운영환경에 적용할 때도 컨테이너를 활용할 수 있다.
3. 동일한 서버가 여러 대 필요한 경우(= 컨테이너 밖과 독립된 성질을 이용)
    - 컨테이너를 이용해 한 대의 물리 서버에 똑같은 서버를 여러개 만들 수 있는데 이렇게 하면 관리도 간편하고 물리 서버를 여러 개의 컨테이너가 공유하므로 비용도 절약된다.
    - 스케일링에 유리하므로 웹 서버나 API 서버로 활용하는 등 다양한 방법이 있다.

![alt text](image-40.png)


### 🐬 

