# 도커 강의 정리

## 1강 
### Docker 
Docker는 "리눅스 컨테이너를 기반으로 만든, OS 레벨 가상화 기술
- Docker은 코드 밀키트를 만드는 것과 같다. 거기다가 OS, 필요한 프로그램, 코드 이런걸 전부 담을 수 있고
Docker를 쓰면 그 밀키트를 버튼 딸깍으로 쉽게 실행해줄 수도 있음

그래서 Docker는 쉽게 말하면
1. 코드 밀키트를 만들고
2. 코드 밀키트를 실행해주는 간단한 프로그램일 뿐입니다.
근데 VM 이런 것 보다 매우 가볍게 동작합니다.



1. 배포가 쉬워졌기 때문에 서버 기능을 쪼개서 여러 프로그램으로 나누고 따로 배포해서 운영하기도함.
	- 이렇게 하면 여러명이서 분업도 편하고 업데이트가 빨라진다
	- 마이크로서비스 아키텍쳐라고 함


 2. 프로그램을 빌드하고 테스트하고 배포하는 작업이 쉬워져
원클릭 딸깍 자동 배포같은걸 도입이 늘어남

 3. 그리고 도커쓰면 원하는 프로그램을 원하는 버전으로 원하는 OS위에 쉽게 설치하고 깔끔하게 삭제도 할 수 있어서 
내가 만든 프로그램을 이거저거 버전별로 테스트해보기도 쉬워짐


#### docker 단점
1. 컨테이너 침입과 같은 새로운 보안이슈를 챙겨야함
2. 컨테이너를 많이 사용하면 관리 시간과 서버비용이 증가함 
3. 안정적인 DB같은거 띄울 땐 컨테이너로 만드는게 딱히 이점이 없음
4. 컨테이너간 완전한 격리를 원하면 컨테이너 말고 가벼운 VM쓰는게 나을 수 있음


## 2강

Docker을 윈도우에서 사용시 WSL2를 설치해서 윈도우 위해 리눅스 OS가상으로 구동해야함


#### 자주 겪는 에러

1. 윈도우는 The network name cannot be found. 이런 에러가 뜨면
시작 - 검색 - powershell 실행 후
```
wsl --unregister docker-desktop
```
입력하고 docker desktop 껐다가 다시 켜보도록 합시다.

 2. 시스템 리소스 부족 에러가 뜨면
아마 램 부족일 수 있어서
램을 잡아먹는 프로그램을 끄거나, 윈도우 재부팅 후 Docker desktop만 실행해봅시다.
아니면 강의에서 소개하는 식으로 터미널에서 명령어들을 실행하는 식으로 docker를 사용합시다.
터미널 켜려면 윈도우는 검색에서 "powershell" 검색해서 실행하고
맥북은 런치패드에서 "터미널" 검색해서 실행하면 됩니다.

### 이미지
- 저번 시간에 밀키트라고 비유해서 설명한걸 멋있는 말로 이미지라고 부름
- 이미지에는 OS, 실행에 필요한 프로그램, 라이브러리, 소스코드 등이 들어있음
- 이미지를 사용하면 환경 맞추기도 쉽고, 내 프로그램을 다른 곳에서 실행하기도 쉽다


예를 들어서 웹서버 프로그램을 열심히 만들어놨는데 그걸 서버 컴퓨터에 배포하고 싶으면 AWS에서 컴퓨터 한 대를 빌려서컴퓨터에 코드옮기고 필요한 프로그램 설치하고웹서버 실행하고 지랄을 해야합니다.

 하지만 도커를 쓰면
- 내 작업환경이랑 코드를 그대로 이미지로 만든 다음에
- 이미지를 그 서버컴퓨터로 옮겨서 실행만 눌러두면 됨.
뭔가 도커 이미지로 싸매놓으면 실행이 느리고 비효율적이지 않을까 싶은데 매우 가벼워서 큰 걱정은 안해도 됨.

**검색창을 통해 이미지를 검색했을 때 Tag라고 써있는건 버전과 비슷한말**

### 컨테이너
이미지 하나를 실행하고 있는 가상 컴퓨터


결론은
1. OS, 개발환경, 소스코드 등을 담아서 이미지를 만들 수 있고
2. 이미지를 실행중인 가상컴퓨터가 컨테이너구나

## 3장

배포하기
1. Dockerfile 만들기
	- Dockerfile은 밀키트 레시피를 적는 곳 
	- 어떤 **OS**를 설치해야 되는지 
	- 어떤 **프로그램 라이브러리**를 설치해야 하는지 
	- 어떤 **터미널 명령어**를 실행할 건지 적어 놓는 곳
	- 내 컴퓨터에 있던 파일은 **어디 집어넣을** 것인지

#### Dockerfile 예시
```
FROM node:22.13-slim
WORKDIR /app
COPY . .
RUN ["npm", "install"]
EXPOSE 8000
CMD ["node", "server.js"]
```
예시)에 넣는 과정
1. OS하나 설치하고
2. nodejs설치하고
3. npm install express 터미널에 입력하고
4. 서버 코드 작성하고
5. node server.js 터미널에 입력

#### FROM 명령어
어떤 OS환경에서 내 프로그램을 실행할지부터 정해야기 때문에 FROM 부터 시작
- Docker hub에서 찾아오면 됨
	- windows 설치하고 싶을시 windows 검색해서 기재
	- 리눅스 OS 설치하고 싶으면 (ubuntu, devian, rehat, alpine) 검색해서 기재
	- 리눅스 서버비가 덜 들기 때문에 리눅스 씀
	- 리눅스 + Node.js 함께 설치된걸 이미 만들어둔 사람도 있어서 그거 설치하면됨
	- **FROM node:22-alpine** 으로 기재하면 Node.js 22버전과 리눅스 os가 설치된 채로 시작
	- slim은 devian 리눅스에서 필요없는거 지운거 alpine은 용량이 가장 작은 리눅스

```
(Dockerfile)

FROM scratch
```
바이너리로 컴파일한 파일만 돌리면 되는경우 OS설치가 딱히 필요없으므로 빈 도화지에서 시작시키기도 함

#### RUN 명령어
- RUN 뒤에 있는 명령어를 실행해줌
- 설치해야 하는 라이브러리가 많은 경우 package.json를 복사해오고 그 다음에 npm install을 입력하면 package.json에 기록되어 있던 라이브러리를 그대로 설치해주는 기능이 있음
- 대괄호를 사용해서 명령어를 입력하는 방식이 더 안정적임
	- 괄호를 안치면 /bin/sh -c npm install 이라는 명령어가 실행이 되는데 이것은 내 os에 기본적으로 설치된 shell을 이용해서 실행하라는 소리다 때문에 shell이라는 프로그램과 거기서 제공하는 && || 이런 명령어가 필요하면 괄호없이 쓰면되는데 shell 기능이 필요없거나 OS마다 shell이 서로 다를 수 있어서 대괄호를 사용용

#### COPY 명령어
```
COPY 내컴퓨터파일경로 이미지내부파일경로

COPY . .
```
. 은 현재 경로이므로 모든 파일과 폴더들을 가상컴퓨터 현재 경로로 복사한다는 뜻

#### .dockerignore
node_modules같은 라이브러리 소스코드는 궅이 복사할 필요가 없음
- 이런 파일은 .dockerignore 파일을 만들어서 파일이나 폴더 경로를 기재하면 됨


#### WORKDIR 
/app 같은 폴더 하나를 만들어서 이동 시키면 파일이 깔끔함
- 현재 작업 경로를 /app 폴더로 바꿔주고 /app 폴더가 없으면 하나 만들어줌


#### CMD 
마지막 명령어는 RUN 말고 CMD 뒤에 적음


#### EXPOSE
EXPOSE 명령어 뒤에 8080 이런 식으로 포트번호를 기재할 수 있습니다.
포트가 뭐냐면 컴퓨터에 뚫린 구멍입니다. 
이게 뚫려있어야 외부 사람들이 내 컴퓨터로 접속이 가능해서 웹서버 운영하는 컴퓨터도 포트를 하나 뚫어줘야합니다.
그래서 코드짤 때 8080 이런 포트를 뚫으라고 코드짜놨습니다.
그래서 이미지 돌릴 컴퓨터에도 8080 포트를 오픈하라고 해야하는데 그건 이미지 실행할 때 명령줄 수 있습니다.
근데 위처럼 EXPOSE 8080 이런걸 작성해놓으면 나중에 포트 오픈하라고 명령줄 때 약간 편리합니다.
그래서 편의를 위해 쓰는 메모같은 개념입니다. 없어도 상관은 없음


#### docker build
```
docker build -t 이미지이름:태그 .
```
작성한 Dockerfile를 바탕으로 이미지를 하나 만들어서 명령을 내릴 수 있음
- 이미지 이름은 맘대로 작명합시다.
- 태그도 맘대로 작명합시다. 태그는 버전이랑 비슷하게 취급하면 됩니다.
- 마침표자리에는 Dockerfile 경로 입력하면 되는데 마침표는 현재경로라는 뜻입니다.
- 참고로 docker desktop 또는 docker engine이 실행되고 있어야 이거 명령어도 사용가능합니다.

이미지 확인은 docker desktop 들어가보거나 터미널에 docker images 입력해봅시다.